FROM python:3.6-slim

# Install Git for version control, GCC and G++
# to compile the files generated by Cython and
# R to execute some standard statistical tests
RUN apt-get update; \
    apt-get install -y git gcc g++ make r-base

# Install the Python requirements to build, lint
# and test the package, create the documentation
# and execute (possible) examples and benchmarks
COPY requirements/*.txt /req/
RUN pip install --upgrade pip; \
    pip install -r /req/benchmarks.txt \
                -r /req/build.txt \
                -r /req/docs.txt \
                -r /req/examples.txt \
                -r /req/style.txt \
                -r /req/tests.txt

# Install the R requirements with the tools to apply
# the standard statistical tests to the benchmarking
COPY commands/* /bin/
RUN chmod +x /bin/pip-r
RUN pip-r /req/analysis.txt

# Create a new user to avoid that the
# container is run in privileged mode
ARG USERNAME=scikit-lr
ENV HOME /home/$USERNAME
RUN useradd -ms /bin/bash $USERNAME
USER $USERNAME
RUN mkdir -p $HOME/workspace
WORKDIR $HOME/workspace

CMD /bin/bash
